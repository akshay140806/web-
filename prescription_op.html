<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Prescription PDF</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Required Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: white;
      margin: 0;
    }

    .no-print {
      margin-top: 20px;
    }

    .prescription-table th, .prescription-table td,
    .vitals-table th, .vitals-table td {
      border: 1px solid #ccc;
      padding: 6px;
      font-size: 0.85rem;
    }

    #pdfContent {
      position: relative;
      z-index: 1;
    }

    .watermark {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      opacity: 0.1;
      z-index: 0;
      width: 400px;
      pointer-events: none;
    }

    @media print {
      .watermark {
        display: none !important;
      }
    }
  </style>
</head>
<body>

<!-- ✅ ALL CONTENT INSIDE THIS DIV -->
<div id="pdfContent" class="relative max-w-4xl mx-auto p-6 bg-white text-sm">

  <!-- Watermark Image -->
  <img src="logo2.png" alt="Watermark" class="watermark" />

  <!-- Header -->
  <div class="flex justify-between items-start border-b pb-4">
    <div class="flex items-center space-x-3">
      <img src="logo2.png" alt="Logo" class="h-16 w-auto" />
      <div>
        <h1 class="text-3xl font-extrabold text-blue-700">SRM</h1>
        <p class="text-xl font-semibold text-gray-800">Dental College</p>
        <p class="text-sm text-gray-500">Ramapuram, Chennai - 600089</p>
      </div>
    </div>
    <div class="text-right text-sm text-gray-600">
      <p class="font-medium">SRM Dental College Hospital</p>
      <p>Ramapuram, Chennai - 600089</p>
      <p><strong>Contact:</strong> +91-44-2249-0526</p>
      <p><strong>Email:</strong> info@srmdental.ac.in</p>
    </div>
  </div>

  <!-- Doctor Info -->
  <div class="py-4 border-b">
    <h2 class="text-xl font-bold text-gray-800">
      Dr. <span id="doctorName">Parvin</span>, BDS, MDS (Periodontics)
    </h2>
    <p class="text-sm text-gray-600">Reg No: <span id="doctorRegNo"></span></p>
  </div>

  <!-- Patient Info -->
  <div class="py-4 border-b grid grid-cols-1 md:grid-cols-2 gap-4">
    <div>
      <p><strong>Name:</strong> Desu Midhun, Male, 22 Yrs</p>
      <p><strong>Mobile:</strong> +91-9876543210</p>
      <p><strong>Patient ID:</strong> A001234567</p>
    </div>
    <div class="md:text-right">
      <p><strong>Date:</strong> <span id="currentDate"></span> <span id="currentTime"></span></p>
    </div>
  </div>

  <!-- Vitals -->
  <div class="py-4 border-b">
    <h3 class="text-lg font-semibold text-gray-800 mb-2">Vitals</h3>
    <table class="w-full vitals-table border-collapse">
      <tr><th>Height</th><td>170 cm</td><th>Sugar</th><td>Normal</td></tr>
      <tr><th>Weight</th><td>65 kg</td><th>BP</th><td>120/80</td></tr>
      <tr><th>Drug Allergies</th><td>None</td><th>Blood Group</th><td>B+</td></tr>
      <tr><th>Diet Allergies</th><td>None</td><th>Temperature</th><td>98.6°F</td></tr>
    </table>
  </div>

  <!-- Medications -->
  <div class="py-4 border-b">
    <h3 class="text-lg font-semibold text-gray-800 mb-2">Medication Prescribed</h3>
    <table class="w-full prescription-table border-collapse">
      <thead class="bg-blue-900 text-white">
        <tr>
          <th>S.No</th><th>Type</th><th>Medicine Name</th><th>Dosage (M-N-E-N)</th>
          <th>Food Intake</th><th>Duration</th><th>Total Qty</th><th>As Needed</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>1</td><td>Rinse</td>
          <td><strong>CHLORHEXIDINE MOUTH RINSE</strong><br><small>Contains: CHLORHEXIDINE GLUCONATE 0.2%</small></td>
          <td>0-0-0-1</td><td>After Food</td><td>10</td><td>10</td><td>No</td>
        </tr>
        <tr>
          <td>2</td><td>Tablet</td>
          <td><strong>AMOXICILLIN 500 MG</strong><br><small>Contains: AMOXICILLIN 500 MG</small></td>
          <td>1-0-1</td><td>After Food</td><td>7</td><td>14</td><td>No</td>
        </tr>
      </tbody>
    </table>
    <p class="text-sm mt-2 text-gray-600"><strong>M-N-E-N:</strong> Morning - Noon - Evening - Night</p>
  </div>

  <!-- Advice -->
  <div class="py-4 border-b">
    <h3 class="text-lg font-semibold text-gray-800 mb-2">Advice & Instructions</h3>
    <ul class="list-disc pl-5 text-sm text-gray-700">
      <li>Maintain good oral hygiene.</li>
      <li>Brush twice daily with a soft-bristled toothbrush.</li>
      <li>Avoid very hot or cold foods/drinks.</li>
      <li>Follow up in 2 weeks or as advised.</li>
    </ul>
  </div>

  <!-- Signature -->
  <div class="py-4 border-b text-right">
    <p class="text-gray-700 font-semibold mt-4 mb-2">___________________</p>
    <p class="text-sm text-gray-600">(Signature of Dr. Parvin)</p>
  </div>

  <!-- Disclaimer -->
  <div class="py-4 bg-gray-50">
    <h4 class="text-sm font-semibold text-gray-700">Disclaimer:</h4>
    <p class="text-xs text-gray-600 mt-1">
      This prescription was generated digitally by SRM Dental College on <span id="generatedDate"></span>.
      Kindly consult a doctor for further advice if symptoms persist.
    </p>
  </div>
</div>

<!-- Button -->
<div class="text-center no-print">
  <button onclick="printToPDF()" class="mt-6 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
    Download Full PDF
  </button>
</div>

<script>
  document.getElementById('currentDate').textContent = new Date().toLocaleDateString('en-IN');
  document.getElementById('currentTime').textContent = new Date().toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit' });
  document.getElementById('generatedDate').textContent = new Date().toLocaleDateString('en-IN');
  document.getElementById('doctorRegNo').textContent = `DCI/${Math.floor(10000 + Math.random() * 90000)}`;

  async function printToPDF() {
    const { jsPDF } = window.jspdf;
    const element = document.getElementById('pdfContent');

    const canvas = await html2canvas(element, {
      scale: 2,
      useCORS: true,
      scrollY: -window.scrollY
    });

    const imgData = canvas.toDataURL('image/jpeg', 1.0);
    const pdf = new jsPDF('p', 'mm', 'a4');
    const pageWidth = pdf.internal.pageSize.getWidth();
    const pageHeight = pdf.internal.pageSize.getHeight();

    const imgWidth = pageWidth;
    const imgHeight = (canvas.height * imgWidth) / canvas.width;

    let heightLeft = imgHeight;
    let position = 0;

    pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
    heightLeft -= pageHeight;

    while (heightLeft > 0) {
      position -= pageHeight;
      pdf.addPage();
      pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
      heightLeft -= pageHeight;
    }

    pdf.save('prescription.pdf');
  }
</script>

</body>
</html>
